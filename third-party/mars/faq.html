<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>常见问题 | 文档管理中心</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="瑞修得移动开发小组文档管理中心">
    
    <link rel="preload" href="/docs/assets/css/0.styles.901409fb.css" as="style"><link rel="preload" href="/docs/assets/js/app.1dda1ef8.js" as="script"><link rel="preload" href="/docs/assets/js/2.1637da50.js" as="script"><link rel="preload" href="/docs/assets/js/58.19058959.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.58dfe90f.js"><link rel="prefetch" href="/docs/assets/js/100.5c67fc3e.js"><link rel="prefetch" href="/docs/assets/js/101.3e719c16.js"><link rel="prefetch" href="/docs/assets/js/102.98816141.js"><link rel="prefetch" href="/docs/assets/js/103.0a5c3a01.js"><link rel="prefetch" href="/docs/assets/js/104.a55d0f0c.js"><link rel="prefetch" href="/docs/assets/js/105.59340145.js"><link rel="prefetch" href="/docs/assets/js/106.b8154cda.js"><link rel="prefetch" href="/docs/assets/js/107.22f6f4f3.js"><link rel="prefetch" href="/docs/assets/js/108.ac08dac5.js"><link rel="prefetch" href="/docs/assets/js/109.261bb23c.js"><link rel="prefetch" href="/docs/assets/js/11.be546261.js"><link rel="prefetch" href="/docs/assets/js/110.40e9908d.js"><link rel="prefetch" href="/docs/assets/js/111.d0bf2613.js"><link rel="prefetch" href="/docs/assets/js/112.acf2ec43.js"><link rel="prefetch" href="/docs/assets/js/113.adea7e7c.js"><link rel="prefetch" href="/docs/assets/js/114.4215f03c.js"><link rel="prefetch" href="/docs/assets/js/115.664f3b94.js"><link rel="prefetch" href="/docs/assets/js/116.721268c9.js"><link rel="prefetch" href="/docs/assets/js/117.592435d2.js"><link rel="prefetch" href="/docs/assets/js/118.fea53932.js"><link rel="prefetch" href="/docs/assets/js/119.720b40e9.js"><link rel="prefetch" href="/docs/assets/js/12.a3a13835.js"><link rel="prefetch" href="/docs/assets/js/120.0816f4ee.js"><link rel="prefetch" href="/docs/assets/js/121.5e9d7e69.js"><link rel="prefetch" href="/docs/assets/js/122.b6a3fdf0.js"><link rel="prefetch" href="/docs/assets/js/123.58800fd8.js"><link rel="prefetch" href="/docs/assets/js/124.7764b45f.js"><link rel="prefetch" href="/docs/assets/js/125.bf736276.js"><link rel="prefetch" href="/docs/assets/js/126.096778ee.js"><link rel="prefetch" href="/docs/assets/js/127.7f3b491a.js"><link rel="prefetch" href="/docs/assets/js/128.2c976ed6.js"><link rel="prefetch" href="/docs/assets/js/129.1558b942.js"><link rel="prefetch" href="/docs/assets/js/13.d66ff325.js"><link rel="prefetch" href="/docs/assets/js/130.521d4737.js"><link rel="prefetch" href="/docs/assets/js/131.28349f1c.js"><link rel="prefetch" href="/docs/assets/js/132.18530a22.js"><link rel="prefetch" href="/docs/assets/js/133.46e03b94.js"><link rel="prefetch" href="/docs/assets/js/134.e8ad93d1.js"><link rel="prefetch" href="/docs/assets/js/135.776ec045.js"><link rel="prefetch" href="/docs/assets/js/136.d546aafe.js"><link rel="prefetch" href="/docs/assets/js/137.93461a95.js"><link rel="prefetch" href="/docs/assets/js/138.2f9a75db.js"><link rel="prefetch" href="/docs/assets/js/139.bb135f58.js"><link rel="prefetch" href="/docs/assets/js/14.586917b9.js"><link rel="prefetch" href="/docs/assets/js/140.6097bf59.js"><link rel="prefetch" href="/docs/assets/js/141.6a6d651b.js"><link rel="prefetch" href="/docs/assets/js/142.d26aa58e.js"><link rel="prefetch" href="/docs/assets/js/143.23821827.js"><link rel="prefetch" href="/docs/assets/js/144.3a4c36b1.js"><link rel="prefetch" href="/docs/assets/js/145.2824b080.js"><link rel="prefetch" href="/docs/assets/js/146.b1e8893f.js"><link rel="prefetch" href="/docs/assets/js/147.d54b971f.js"><link rel="prefetch" href="/docs/assets/js/148.369df7cc.js"><link rel="prefetch" href="/docs/assets/js/149.1bf135cd.js"><link rel="prefetch" href="/docs/assets/js/15.719b9ed4.js"><link rel="prefetch" href="/docs/assets/js/16.801ae469.js"><link rel="prefetch" href="/docs/assets/js/17.caf90ccc.js"><link rel="prefetch" href="/docs/assets/js/18.9b1430b4.js"><link rel="prefetch" href="/docs/assets/js/19.a7ce47c6.js"><link rel="prefetch" href="/docs/assets/js/20.c6f145a7.js"><link rel="prefetch" href="/docs/assets/js/21.96ad3811.js"><link rel="prefetch" href="/docs/assets/js/22.8b467667.js"><link rel="prefetch" href="/docs/assets/js/23.12614503.js"><link rel="prefetch" href="/docs/assets/js/24.9fd2bb95.js"><link rel="prefetch" href="/docs/assets/js/25.1666b1f6.js"><link rel="prefetch" href="/docs/assets/js/26.59796892.js"><link rel="prefetch" href="/docs/assets/js/27.99afdda0.js"><link rel="prefetch" href="/docs/assets/js/28.b4d6b486.js"><link rel="prefetch" href="/docs/assets/js/29.afbc8554.js"><link rel="prefetch" href="/docs/assets/js/3.3c077cdd.js"><link rel="prefetch" href="/docs/assets/js/30.707e9271.js"><link rel="prefetch" href="/docs/assets/js/31.1f01bd11.js"><link rel="prefetch" href="/docs/assets/js/32.58b8cdf9.js"><link rel="prefetch" href="/docs/assets/js/33.5e6d8fb9.js"><link rel="prefetch" href="/docs/assets/js/34.7a9c9f16.js"><link rel="prefetch" href="/docs/assets/js/35.314a3788.js"><link rel="prefetch" href="/docs/assets/js/36.54191cc3.js"><link rel="prefetch" href="/docs/assets/js/37.44382138.js"><link rel="prefetch" href="/docs/assets/js/38.5380da44.js"><link rel="prefetch" href="/docs/assets/js/39.34ebb7c0.js"><link rel="prefetch" href="/docs/assets/js/4.b333c14c.js"><link rel="prefetch" href="/docs/assets/js/40.0453b798.js"><link rel="prefetch" href="/docs/assets/js/41.36d65bc4.js"><link rel="prefetch" href="/docs/assets/js/42.04cba918.js"><link rel="prefetch" href="/docs/assets/js/43.ee454731.js"><link rel="prefetch" href="/docs/assets/js/44.256c268b.js"><link rel="prefetch" href="/docs/assets/js/45.7a79bfa1.js"><link rel="prefetch" href="/docs/assets/js/46.71832f87.js"><link rel="prefetch" href="/docs/assets/js/47.102136b0.js"><link rel="prefetch" href="/docs/assets/js/48.1b555eed.js"><link rel="prefetch" href="/docs/assets/js/49.2dad9744.js"><link rel="prefetch" href="/docs/assets/js/5.80d7978e.js"><link rel="prefetch" href="/docs/assets/js/50.2bffebce.js"><link rel="prefetch" href="/docs/assets/js/51.67de7f5b.js"><link rel="prefetch" href="/docs/assets/js/52.1fb2cbfa.js"><link rel="prefetch" href="/docs/assets/js/53.86f280a5.js"><link rel="prefetch" href="/docs/assets/js/54.ba5fd39f.js"><link rel="prefetch" href="/docs/assets/js/55.fbf0c266.js"><link rel="prefetch" href="/docs/assets/js/56.78f10d2c.js"><link rel="prefetch" href="/docs/assets/js/57.5a2a2006.js"><link rel="prefetch" href="/docs/assets/js/59.7c1efd15.js"><link rel="prefetch" href="/docs/assets/js/6.93c23e29.js"><link rel="prefetch" href="/docs/assets/js/60.500e14b5.js"><link rel="prefetch" href="/docs/assets/js/61.ba85c18e.js"><link rel="prefetch" href="/docs/assets/js/62.6a199316.js"><link rel="prefetch" href="/docs/assets/js/63.e778bbfe.js"><link rel="prefetch" href="/docs/assets/js/64.c69ba645.js"><link rel="prefetch" href="/docs/assets/js/65.66afc7d5.js"><link rel="prefetch" href="/docs/assets/js/66.c60f23f3.js"><link rel="prefetch" href="/docs/assets/js/67.35ea2d93.js"><link rel="prefetch" href="/docs/assets/js/68.6f128c5c.js"><link rel="prefetch" href="/docs/assets/js/69.e8601092.js"><link rel="prefetch" href="/docs/assets/js/7.e0defabf.js"><link rel="prefetch" href="/docs/assets/js/70.e15c66b9.js"><link rel="prefetch" href="/docs/assets/js/71.65a385e6.js"><link rel="prefetch" href="/docs/assets/js/72.fddf5dc9.js"><link rel="prefetch" href="/docs/assets/js/73.b55e21d6.js"><link rel="prefetch" href="/docs/assets/js/74.78f2bb84.js"><link rel="prefetch" href="/docs/assets/js/75.3291174d.js"><link rel="prefetch" href="/docs/assets/js/76.ca315e89.js"><link rel="prefetch" href="/docs/assets/js/77.8f31a3ff.js"><link rel="prefetch" href="/docs/assets/js/78.4df66be0.js"><link rel="prefetch" href="/docs/assets/js/79.7b82ad6e.js"><link rel="prefetch" href="/docs/assets/js/8.d96ec7b2.js"><link rel="prefetch" href="/docs/assets/js/80.4aa5f85b.js"><link rel="prefetch" href="/docs/assets/js/81.ee0c5d7a.js"><link rel="prefetch" href="/docs/assets/js/82.f5d076b2.js"><link rel="prefetch" href="/docs/assets/js/83.b7d9c0c6.js"><link rel="prefetch" href="/docs/assets/js/84.c8b235a0.js"><link rel="prefetch" href="/docs/assets/js/85.a2f95b9e.js"><link rel="prefetch" href="/docs/assets/js/86.dd6142ae.js"><link rel="prefetch" href="/docs/assets/js/87.d068751e.js"><link rel="prefetch" href="/docs/assets/js/88.18f2cebe.js"><link rel="prefetch" href="/docs/assets/js/89.cdb95e7d.js"><link rel="prefetch" href="/docs/assets/js/9.2bf6fce9.js"><link rel="prefetch" href="/docs/assets/js/90.c40ac454.js"><link rel="prefetch" href="/docs/assets/js/91.6f03a350.js"><link rel="prefetch" href="/docs/assets/js/92.183da242.js"><link rel="prefetch" href="/docs/assets/js/93.4abdb53c.js"><link rel="prefetch" href="/docs/assets/js/94.96d80901.js"><link rel="prefetch" href="/docs/assets/js/95.08358998.js"><link rel="prefetch" href="/docs/assets/js/96.61287424.js"><link rel="prefetch" href="/docs/assets/js/97.a0c32235.js"><link rel="prefetch" href="/docs/assets/js/98.ee4911f9.js"><link rel="prefetch" href="/docs/assets/js/99.fae638a9.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.901409fb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">文档管理中心</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Third Party" class="dropdown-title"><span class="title">Third Party</span> <span class="arrow down"></span></button> <button type="button" aria-label="Third Party" class="mobile-dropdown-title"><span class="title">Third Party</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/third-party/arouter/" class="nav-link">
  ARouter
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/bugly/" class="nav-link">
  Bugly
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/dokka/" class="nav-link">
  Dokka
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/greendao/" class="nav-link">
  greenDAO
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/koin/" class="nav-link">
  Koin
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/mars/" class="nav-link router-link-active">
  Mars
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/mmkv/" class="nav-link">
  MMKV
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/mtj/" class="nav-link">
  百度移动统计
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/objectbox/" class="nav-link">
  Objectbox
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/okhttp/" class="nav-link">
  OkHttp
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/orhanobut-logger/" class="nav-link">
  Orhanobut Logger
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/retrofit/" class="nav-link">
  Retrofit
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/rxjava/" class="nav-link">
  Rxjava
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/sentry/" class="nav-link">
  Sentry
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/umeng/" class="nav-link">
  友盟+
</a></li></ul></div></div><div class="nav-item"><a href="https://ruixiude.github.io/apidocs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线API文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Third Party" class="dropdown-title"><span class="title">Third Party</span> <span class="arrow down"></span></button> <button type="button" aria-label="Third Party" class="mobile-dropdown-title"><span class="title">Third Party</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/third-party/arouter/" class="nav-link">
  ARouter
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/bugly/" class="nav-link">
  Bugly
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/dokka/" class="nav-link">
  Dokka
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/greendao/" class="nav-link">
  greenDAO
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/koin/" class="nav-link">
  Koin
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/mars/" class="nav-link router-link-active">
  Mars
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/mmkv/" class="nav-link">
  MMKV
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/mtj/" class="nav-link">
  百度移动统计
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/objectbox/" class="nav-link">
  Objectbox
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/okhttp/" class="nav-link">
  OkHttp
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/orhanobut-logger/" class="nav-link">
  Orhanobut Logger
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/retrofit/" class="nav-link">
  Retrofit
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/rxjava/" class="nav-link">
  Rxjava
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/sentry/" class="nav-link">
  Sentry
</a></li><li class="dropdown-item"><!----> <a href="/docs/third-party/umeng/" class="nav-link">
  友盟+
</a></li></ul></div></div><div class="nav-item"><a href="https://ruixiude.github.io/apidocs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线API文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/third-party/mars/" aria-current="page" class="sidebar-link">Mars</a></li><li><a href="/docs/third-party/mars/instruction-manual.html" class="sidebar-link">Android 接入指南</a></li><li><a href="/docs/third-party/mars/terminology.html" class="sidebar-link">常用术语</a></li><li><a href="/docs/third-party/mars/faq.html" aria-current="page" class="active sidebar-link">常见问题</a><ul class="sidebar-sub-headers"></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Advance</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="常见问题"><a href="#常见问题" class="header-anchor">#</a> 常见问题</h1> <h1 id="通用问题"><a href="#通用问题" class="header-anchor">#</a> 通用问题</h1> <h3 id="mars-sample-代码可以直接用到生产环境中吗"><a href="#mars-sample-代码可以直接用到生产环境中吗" class="header-anchor">#</a> Mars sample 代码可以直接用到生产环境中吗？</h3> <p>不建议用到生产环境中，这部分代码是未经过微信验证的 demo 代码</p> <h3 id="mars-包括服务端吗"><a href="#mars-包括服务端吗" class="header-anchor">#</a> Mars 包括服务端吗？</h3> <p>Mars 只是一个客户端的解决方案，并不包括服务端的代码。 如果使用 Mars 中的 STN，需要客户端和服务端对齐好协议。</p> <h3 id="mars-中的-stn-和-xlog-可以在一个应用多个进程中使用吗"><a href="#mars-中的-stn-和-xlog-可以在一个应用多个进程中使用吗" class="header-anchor">#</a> Mars 中的 STN 和 Xlog 可以在一个应用多个进程中使用吗？</h3> <p>STN 不可以，也不建议，如果你执意这么做，请给getAppFilePath的回调返回不同的路径。 Xlog 可以，只需要你传参数的时候日志的前缀不要传相同的就行。</p> <h3 id="如果我已经有现有服务器端了-客户端想使用-mars-需要服务器做什么工作"><a href="#如果我已经有现有服务器端了-客户端想使用-mars-需要服务器做什么工作" class="header-anchor">#</a> 如果我已经有现有服务器端了，客户端想使用 Mars，需要服务器做什么工作？</h3> <p>如果你已经深入了解了 Mars，感觉自己适合使用 Mars的，需要先理解长短连协议和加解包的区别。不论之前使用的哪种方式，长短连的协议是必须有的，你需要参照<a href="https://github.com/Tencent/mars/wiki/Mars-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%89%A9%E5%B1%95" target="_blank" rel="noopener noreferrer">自定义扩展<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>把长短连协议和服务器端对齐， 至于加解包逻辑是在 Req2Buf 和 Buf2Resp 回调中做的，给上实现就可以了。关于长短连协议的理解和 req2Buf buf2Resp 的理解可以看一个例子：就像你用 HTTP 发一个 json 数据 HTTP 就类似 Mars 的长短连协议， json 的组装和解析就是 req2Buf 和 buf2Resp 来做的</p> <h3 id="如果我已经有现有服务器端了-客户端想使用-mars-客户端需要注意什么"><a href="#如果我已经有现有服务器端了-客户端想使用-mars-客户端需要注意什么" class="header-anchor">#</a> 如果我已经有现有服务器端了，客户端想使用 Mars，客户端需要注意什么？</h3> <p><a href="https://github.com/Tencent/mars/blob/master/mars/stn/proto/longlink_packer.cc" target="_blank" rel="noopener noreferrer">longlink_packer.cc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中的自定义需要注意。心跳包的cmdid一定要和服务器的对应上，否则可能发生心跳包超时导致长连断开。longlink_complexconnect_need_verify的含义是如果设为 true 经过心跳包验证的连接才认为是成功的连接。如果你的长连接建立连接后第一个包必须是验证包，该函数的返回值一定要设为false。 长连的鉴权是会回调GetLonglinkIdentifyCheckBuffer这个函数，实现即可，记得处理回包：OnLonglinkIdentifyResponse,需要区分开长连接的鉴权和用户的登陆。长连的鉴权只是用来表示这个长连接是某个人的，不要用来做登陆功能。 强调：需要注意，mars长连的请求包和回包的对应关系的条件是seq一样，所以服务器对请求的回应要保证seq一样，或者可以自己在longlink_taskmanger.cc里修改(不推荐)。</p> <h3 id="如果我们的客户端不使用域名使用多个ip的情况下怎么使用mars-比如-客户端会-hardcode-一批-ips1-用户连上服务器服务器会下发一批-ips2。"><a href="#如果我们的客户端不使用域名使用多个ip的情况下怎么使用mars-比如-客户端会-hardcode-一批-ips1-用户连上服务器服务器会下发一批-ips2。" class="header-anchor">#</a> 如果我们的客户端不使用域名使用多个IP的情况下怎么使用Mars？比如：客户端会 hardcode 一批 IPs1，用户连上服务器服务器会下发一批 IPs2。</h3> <p>目前 Mars 长连提供设置 host 信息的接口是 setLonglinkSvrAddr 只支持设置单个域名，会在 Mars 中进行解析 IP。但是这个接口不能重复调用，只会以最后一次调用为准。所以如果你们只有 IP 列表没有域名的话，例如上面的场景，我们建议的解决方案：把 IPs1 通过 setBackupIPs 设给Mars，随机从 IPs1 中选择一个 randomip 当做 setLonglinkSvrAddr 的 host 设给 Mars，在 onNewDns 回调接口中当发现是 host 是之前的 randomip 时把 IPs2 返回给 Mars。 这几种IP的优先级请参考 <a href="https://github.com/Tencent/mars/wiki/Mars-%E5%B8%B8%E7%94%A8%E6%9C%AF%E8%AF%AD" target="_blank" rel="noopener noreferrer">Mars 常用术语<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="使用了mars发现接收比较大的数据比较容易失败-是什么原因"><a href="#使用了mars发现接收比较大的数据比较容易失败-是什么原因" class="header-anchor">#</a> 使用了Mars发现接收比较大的数据比较容易失败，是什么原因？</h3> <p>Mars 主要针对信令数据而设计的，如果一个数据需要接收时间比较长，会被认为超时，建议单个数据包不要超过 64 k</p> <h3 id="我在自己机器上启动-demo-中的-server-为什么一直在-downloading-gradle-卡了很久。"><a href="#我在自己机器上启动-demo-中的-server-为什么一直在-downloading-gradle-卡了很久。" class="header-anchor">#</a> 我在自己机器上启动 demo 中的 server, 为什么一直在 Downloading gradle，卡了很久。</h3> <p>运行server前，如果你本机没有安装过gradle, 会自动安装。如果一直卡住，建议翻墙或者更换VPN试试。</p> <h3 id="一个任务在-mars-中流转的流程是怎么样的"><a href="#一个任务在-mars-中流转的流程是怎么样的" class="header-anchor">#</a> 一个任务在 Mars 中流转的流程是怎么样的？</h3> <p>一个任务以 startTask 为开始，以 onTaskEnd 为结束。 首先调用 startTask-&gt; 如果你的任务设置了 limit_flow=true 或者 limit_frequency=true 会进行防雪崩检测 -&gt; 如果设置了need_authed = true 会回调 makesureAuth 询问是否已经是登陆态，不是的话需要上层异步去登陆，底层任务会等待-&gt; 回调 req2Buf 进行打包-&gt; 发送 -&gt;如果send_only = false 就是需要等待回包, 不需要等待的话会直接调用 onTaskEnd -&gt; 收到回包回调上层 buf2Resp 进行解包 -&gt; onTaskEnd。关于长短连协议的理解和 req2Buf buf2Resp 的理解可以看一个例子：就像你用 HTTP 发一个 json 数据 HTTP 就类似 Mars 的长短连协议， json 的组装和解析就是 req2Buf 和 buf2Resp 来做的</p> <h3 id="mars-中哪些模块是可以独立使用的"><a href="#mars-中哪些模块是可以独立使用的" class="header-anchor">#</a> Mars 中哪些模块是可以独立使用的？</h3> <p>Xlog 是可以独立使用的，SDT 暂时不可以单独使用。SDT的自动逻辑会被STN自动触发。</p> <h3 id="xlog-文件怎么查看"><a href="#xlog-文件怎么查看" class="header-anchor">#</a> Xlog 文件怎么查看？</h3> <p>参看<a href="https://github.com/Tencent/mars/wiki/Xlog-%E5%8A%A0%E5%AF%86%E4%BD%BF%E7%94%A8%E6%8C%87%E5%BC%95" target="_blank" rel="noopener noreferrer">Xlog-加密使用指引<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="xlog-目录下存放的-mmap2-文件有什么用"><a href="#xlog-目录下存放的-mmap2-文件有什么用" class="header-anchor">#</a> Xlog 目录下存放的 mmap2 文件有什么用?</h3> <p>mmap2 文件为 Xlog 的缓存文件，不用关注，真正的日志内容在以 xlog 为后缀的文件中。</p> <h3 id="为什么我使用了-xlog-会感觉应用卡顿"><a href="#为什么我使用了-xlog-会感觉应用卡顿" class="header-anchor">#</a> 为什么我使用了 Xlog 会感觉应用卡顿？</h3> <p>使用 Xlog 的时候请尽量不要使用同步模式，同步模式会直接写文件，同步模式主要为了调试环境用的。推荐的模式为异步模式，INFO级别。</p> <h3 id="xlog-对日志文件的自动清理逻辑是怎么样的"><a href="#xlog-对日志文件的自动清理逻辑是怎么样的" class="header-anchor">#</a> Xlog 对日志文件的自动清理逻辑是怎么样的？</h3> <p>每次启动时会删除过期文件，只保留十天内的日志文件(该值定义在<a href="https://github.com/Tencent/mars/blob/master/mars/log/src/appender.cc" target="_blank" rel="noopener noreferrer">appender.cc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中的 kMaxLogAliveTime )，所以给 Xlog 的目录请使用单独目录，防止误删其他文件。目前不会根据文件大小进行清理。如若想自定义清理逻辑请自行更改<a href="https://github.com/Tencent/mars/blob/master/mars/log/src/appender.cc" target="_blank" rel="noopener noreferrer">appender.cc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中的 __del_timeout_file 函数。 #Android</p> <h3 id="执行-python-build-android-py-编译错误"><a href="#执行-python-build-android-py-编译错误" class="header-anchor">#</a> 执行 python build_android.py 编译错误</h3> <p>先区分是否是 python 的语法错误，如果是，请先确保 python 版本为2.7x, 如果是编译过程中的错误，请确保使用的 ndk 版本为 ndk-r16b 以上，强烈建议使用 ndk-r16b(官方下载旧版本方法：下载最新版本的 url 中 ndk 版本号直接改为想要的版本号即可)。如果你的平台是 Windows 系统，还需要安装 cygwin，并务必要安装其中的 make, gcc gdb。 然后把 cygwin 的 bin 目录配置到环境变量中的 PATH 中。如若仍然不能解决，请联系我们。</p> <h3 id="debug版本下没问题-release版本下报-java-lang-unsatisfiedlinkerror"><a href="#debug版本下没问题-release版本下报-java-lang-unsatisfiedlinkerror" class="header-anchor">#</a> Debug版本下没问题，release版本下报 java.lang.UnsatisfiedLinkError</h3> <p>release版本下是否混淆了代码，如果混淆了把mars相关的代码keep下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>-keep class com.tencent.mars.** {
  public protected private *;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>或</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>-keep class com.tencent.mars.xlog.** { *; }
-keep class com.tencent.mars.comm.* { *; }
-keep class com.tencent.mars.app.* { *; }
-keep class com.tencent.mars.stn.* {*;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="如何调试"><a href="#如何调试" class="header-anchor">#</a> 如何调试</h3> <p>目前 Mars 的项目组织方式在 Android 平台下调试并不友好，建议通过 xlog 输出的信息进行排查问题。</p> <h3 id="为什么我的-xlog-文件使用-decode-mars-log-py-解出来有很多错误存在"><a href="#为什么我的-xlog-文件使用-decode-mars-log-py-解出来有很多错误存在" class="header-anchor">#</a> 为什么我的 xlog 文件使用 decode_mars_log.py 解出来有很多错误存在？</h3> <p>目前 xlog 不支持多个进程写到同一个文件中，先确认是否是因为多个进程把日志写到同一个文件所致。</p> <h3 id="打开-xlog-的-sample-报-libmarsxlog-so-exists-or-that-its-paths-is-correct"><a href="#打开-xlog-的-sample-报-libmarsxlog-so-exists-or-that-its-paths-is-correct" class="header-anchor">#</a> 打开 xlog 的 sample 报：…………libmarsxlog.so exists or that its paths is correct……</h3> <p>如果出现下图：
<img src="/assets/images/mars/sync_fail.png" alt="img">
请重试直到这个 tips 消失。如果一直重试不成功可以尝试把下面的代码先注释掉再 Try Again。成功后再取消掉：
<img src="/assets/images/mars/comment_ndk.png" alt="img"></p> <h3 id="多进程应用使用-mars-应该注意什么"><a href="#多进程应用使用-mars-应该注意什么" class="header-anchor">#</a> 多进程应用使用 Mars 应该注意什么？</h3> <p>调用 native 函数前一定要确保包含 native 函数的实现的 so 是在本进程中，如果不在，可能需要跨进程调用或者先 load so。</p> <h3 id="native-代码的-crash-监控应该怎么做"><a href="#native-代码的-crash-监控应该怎么做" class="header-anchor">#</a> native 代码的 crash 监控应该怎么做？</h3> <p>mars 是经过微信验证过的，稳定性方面是有保证的。不过你依然可以有自己的 crash 监控模块。 native crash 捕捉原理是基于 linux 的信号机制进行堆栈回溯。具体实现可以参考 Android 内核源码中 libunwind 和 libcorkscrew。不建议使用 dlopen 进行调用，因为安全问题谷歌会在不久的将来禁止 dlopen 系统库(个别库除外)。 第三方 crash 捕捉服务推荐使用 <a href="https://bugly.qq.com/v2/" target="_blank" rel="noopener noreferrer">Bugly<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="xlog有大量的-signal-7-sigbus-code-2-bus-adrerr-crash-什么原因导致的"><a href="#xlog有大量的-signal-7-sigbus-code-2-bus-adrerr-crash-什么原因导致的" class="header-anchor">#</a> xlog有大量的 <code>signal 7 (SIGBUS), code 2 (BUS_ADRERR)</code> crash, 什么原因导致的？</h3> <p><a href="https://github.com/Tencent/mars/issues/204" target="_blank" rel="noopener noreferrer">#204<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://github.com/Tencent/mars/issues/249" target="_blank" rel="noopener noreferrer">#249<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。
注意：日志不要放在这个目录，不然就太占 data 空间了。缓存目录类似日志目录，要单独目录，防止清理逻辑误删其他文件，而且缓存目录一定要是data下的私有目录，可以使用 /data/data/packagename/files/xlog/</p> <h3 id="为什么长连断之后很长时间都不去尝试连"><a href="#为什么长连断之后很长时间都不去尝试连" class="header-anchor">#</a> 为什么长连断之后很长时间都不去尝试连？</h3> <p>考虑用户的电量和流量，长连的连接策略会根据应用的前后台而不同。 请先确认是否忘记在前后台切换时主动调用</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>BaseEvent.onForeground(boolean);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h1 id="ios-os-x"><a href="#ios-os-x" class="header-anchor">#</a> iOS/OS X</h1> <h3 id="为什么-apple-系平台没有通过-cocoapods-来管理类库"><a href="#为什么-apple-系平台没有通过-cocoapods-来管理类库" class="header-anchor">#</a> 为什么 Apple 系平台没有通过 CocoaPods 来管理类库？</h3> <p>我们一直认为合适的才是最好的。Mars 是有很多子项目，每个子项目是单独的编译配置，这点 CocoaPods 做不到，因为 CocoaPods 是一个项目文件，如果引入 CocoaPods 就必须多维护一套编译脚本，而且丢失了我们目前多个子项目的优势，所以并不适合我们的项目。</p> <h3 id="打开-mars-时-为什么有时某个子项目无法展开"><a href="#打开-mars-时-为什么有时某个子项目无法展开" class="header-anchor">#</a> 打开 Mars 时，为什么有时某个子项目无法展开？</h3> <p>请确认是否已经在 xcode 中单独打开了该子项目，如果已经单独打开，请先关闭，再打开 Mars。</p> <h3 id="编译时为什么提示-string-not-found-或其他-c-c-头文件找不到的错误"><a href="#编译时为什么提示-string-not-found-或其他-c-c-头文件找不到的错误" class="header-anchor">#</a> 编译时为什么提示 &quot;string not found&quot; 或其他 C/C++ 头文件找不到的错误？</h3> <p>请确认直接调用 C/C++接口的 Objc 源文件是否都是 .mm 后缀，如果不是，请把 .m 后缀改为 .mm 。</p> <h3 id="为什么编译-demo-时-xcode-的进度条一直没进度-感觉被卡住了"><a href="#为什么编译-demo-时-xcode-的进度条一直没进度-感觉被卡住了" class="header-anchor">#</a> 为什么编译 demo 时 xcode 的进度条一直没进度，感觉被卡住了？</h3> <p>为了保证使用的 Mars 代码是最新代码，每次编译 demo 都会通过 Run Script 编译 Mars。 如果已经编译过一次，可以把 Run Script 移除，防止重复编译。</p> <h3 id="为什么使用脚本编译的-framework-链接运行没问题-但是调试过程中会中断言"><a href="#为什么使用脚本编译的-framework-链接运行没问题-但是调试过程中会中断言" class="header-anchor">#</a> 为什么使用脚本编译的 framework 链接运行没问题，但是调试过程中会中断言？</h3> <p>使用编译脚本编译的 framework 是 release 版本的，即使中断言，也只会打一行日志，并不会导致程序退出，调试过程中生成的 Mars 的库是 debug 版本的，中断言会导致程序退出。 中断言一般因为某些 callback 没有设置，或者 callback 中的某个函数没有实现，请结合堆栈进行分析。</p> <h3 id="为什么长连断之后很长时间都不去尝试连-2"><a href="#为什么长连断之后很长时间都不去尝试连-2" class="header-anchor">#</a> 为什么长连断之后很长时间都不去尝试连？</h3> <p>考虑用户的电量和流量，长连的连接策略会根据应用的前后台而不同。 请先确认是否忘记在前后台切换时主动调用</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mars::baseevent::OnForeground(isForground);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="sample-server启动失败"><a href="#sample-server启动失败" class="header-anchor">#</a> Sample Server启动失败</h3> <ol><li>当下载gradle过程中出现javax.net.ssl.SSLException: SSL peer shutdown incorrectly时，是由于无法连接google service导致，请确认命令行已翻墙。</li> <li>当下载gradle过程中出现java.util.zip.ZipException: error in opening zip file时，是由于下载的gradle.zip文件出现错误导致，请删除前面提示路径下的zip文件，重新启动server，这时会重新去下载。</li> <li>当启动server过程中出现jetty 或 netty启动failed，请使用./gradlew :server:jettyRun --stacktrace或./gradlew :server:nettyRun --stacktrace启动查看具体出错信息，如果出现address already used/bind，说明端口号被占用，jetty默认8080，netty默认8081，如果想要修改端口号，请在server工程中搜索端口号数字，修改。</li></ol> <h3 id="sdt常见问题"><a href="#sdt常见问题" class="header-anchor">#</a> SDT常见问题</h3> <ol><li>SDT是由STN在网络连接、收发失败过程中根据实际情况，自启动的网络检测工具，目前并没有提供给上层主动检测的接口</li> <li>SDT源码完整，未提供主动检测的功能，是我们认为目前手段非完整性还需要完善，目前包含tcp心跳测试、http连接测试、ping、dns测试</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/third-party/mars/terminology.html" class="prev">
        常用术语
      </a></span> <span class="next"><a href="/docs/third-party/mars/advance/custom-extensions.html">
        自定义扩展
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.1dda1ef8.js" defer></script><script src="/docs/assets/js/2.1637da50.js" defer></script><script src="/docs/assets/js/58.19058959.js" defer></script>
  </body>
</html>
