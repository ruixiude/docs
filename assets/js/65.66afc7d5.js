(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{424:function(t,s,n){"use strict";n.r(s);var a=n(42),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"mmkv"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mmkv"}},[t._v("#")]),t._v(" MMKV")]),t._v(" "),n("p",[t._v("MMKV 是基于 mmap 内存映射的 key-value 组件，底层序列化/反序列化使用 protobuf 实现，性能高，稳定性强。从 2015 年中至今在微信上使用，其性能和稳定性经过了时间的验证。近期也已移植到 Android / macOS / Win32 / POSIX 平台，一并开源。")]),t._v(" "),n("h2",{attrs:{id:"mmkv-源起"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mmkv-源起"}},[t._v("#")]),t._v(" MMKV 源起")]),t._v(" "),n("p",[t._v("在微信客户端的日常运营中，时不时就会爆发特殊文字引起系统的 crash，"),n("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzAwNDY1ODY2OQ==&mid=2649286826&idx=1&sn=35601cb1156617aa235b7fd4b085bfc4",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文章"),n("OutboundLink")],1),t._v("，文章里面设计的技术方案是在关键代码前后进行计数器的加减，通过检查计数器的异常，来发现引起闪退的异常文字。在会话列表、会话界面等有大量 cell 的地方，希望新加的计时器不会影响滑动性能；另外这些计数器还要永久存储下来——因为闪退随时可能发生。这就需要一个性能非常高的通用 key-value 存储组件，我们考察了 SharedPreferences、NSUserDefaults、SQLite 等常见组件，发现都没能满足如此苛刻的性能要求。考虑到这个防 crash 方案最主要的诉求还是实时写入，而 mmap 内存映射文件刚好满足这种需求，我们尝试通过它来实现一套 key-value 组件。")]),t._v(" "),n("h2",{attrs:{id:"mmkv-原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mmkv-原理"}},[t._v("#")]),t._v(" MMKV 原理")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("内存准备")]),n("br"),t._v("\n通过 mmap 内存映射文件，提供一段可供随时写入的内存块，App 只管往里面写数据，由操作系统负责将内存回写到文件，不必担心 crash 导致数据丢失。")]),t._v(" "),n("li",[n("strong",[t._v("数据组织")]),n("br"),t._v("\n数据序列化方面我们选用 protobuf 协议，pb 在性能和空间占用上都有不错的表现。")]),t._v(" "),n("li",[n("strong",[t._v("写入优化")]),n("br"),t._v("\n考虑到主要使用场景是频繁地进行写入更新，我们需要有增量更新的能力。我们考虑将增量 kv 对象序列化后，append 到内存末尾。")]),t._v(" "),n("li",[n("strong",[t._v("空间增长")]),n("br"),t._v("\n使用 append 实现增量更新带来了一个新的问题，就是不断 append 的话，文件大小会增长得不可控。我们需要在性能和空间上做个折中。")])]),t._v(" "),n("p",[t._v("更详细的设计原理参考 "),n("a",{attrs:{href:"https://github.com/Tencent/MMKV/wiki/design",target:"_blank",rel:"noopener noreferrer"}},[t._v("MMKV 原理"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"android-指南"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#android-指南"}},[t._v("#")]),t._v(" Android 指南")]),t._v(" "),n("h3",{attrs:{id:"安装引入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装引入"}},[t._v("#")]),t._v(" 安装引入")]),t._v(" "),n("p",[t._v("推荐使用 Maven：")]),t._v(" "),n("div",{staticClass:"language-gradle line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("dependencies {\n    implementation 'com.tencent:mmkv-static:1.2.7'\n    // replace \"1.2.7\" with any available version\n}\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("p",[t._v("更多安装指引参考 "),n("a",{attrs:{href:"https://github.com/Tencent/MMKV/wiki/android_setup_cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("Android Setup"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"快速上手"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#快速上手"}},[t._v("#")]),t._v(" 快速上手")]),t._v(" "),n("p",[t._v("MMKV 的使用非常简单，所有变更立马生效，无需调用 "),n("code",[t._v("sync")]),t._v("、"),n("code",[t._v("apply")]),t._v("。\n在 App 启动时初始化 MMKV，设定 MMKV 的根目录（files/mmkv/），例如在 "),n("code",[t._v("Application")]),t._v(" 里：")]),t._v(" "),n("div",{staticClass:"language-Java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onCreate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onCreate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" rootDir "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" MMKV"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initialize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mmkv root: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" rootDir"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//……")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("p",[t._v("MMKV 提供一个全局的实例，可以直接使用：")]),t._v(" "),n("div",{staticClass:"language-Java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tencent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mmkv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("MMKV"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//……")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MMKV")]),t._v(" kv "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" MMKV"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("defaultMMKV")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nkv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("encode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bool"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" bValue "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" kv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("decodeBool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bool"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nkv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("encode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MIN_VALUE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" iValue "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" kv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("decodeInt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"int"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nkv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("encode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello from mmkv"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" str "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" kv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("decodeString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])]),n("p",[t._v("MMKV 支持"),n("strong",[t._v("多进程访问")]),t._v("，更详细的用法参考 "),n("a",{attrs:{href:"https://github.com/Tencent/MMKV/wiki/android_tutorial_cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("Android Tutorial"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"性能对比"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#性能对比"}},[t._v("#")]),t._v(" 性能对比")]),t._v(" "),n("p",[t._v("循环写入随机的"),n("code",[t._v("int")]),t._v(" 1k 次，我们有如下性能对比："),n("br"),t._v(" "),n("img",{attrs:{src:"https://github.com/Tencent/MMKV/wiki/assets/profile_android_mini.png",alt:""}}),n("br"),t._v("\n更详细的性能对比参考 "),n("a",{attrs:{href:"https://github.com/Tencent/MMKV/wiki/android_benchmark_cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("Android Benchmark"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"ios-macos-指南"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ios-macos-指南"}},[t._v("#")]),t._v(" iOS/macOS 指南")]),t._v(" "),n("h3",{attrs:{id:"安装引入-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装引入-2"}},[t._v("#")]),t._v(" 安装引入")]),t._v(" "),n("p",[t._v("推荐使用 CocoaPods：")]),t._v(" "),n("ol",[n("li",[t._v("安装 "),n("a",{attrs:{href:"https://guides.CocoaPods.org/using/getting-started.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("CocoaPods"),n("OutboundLink")],1),t._v("；")]),t._v(" "),n("li",[t._v("打开命令行, "),n("code",[t._v("cd")]),t._v(" 到你的项目工程目录, 输入 "),n("code",[t._v("pod repo update")]),t._v(" 让 CocoaPods 感知最新的 MMKV 版本；")]),t._v(" "),n("li",[t._v("打开 Podfile, 添加 "),n("code",[t._v("pod 'MMKV'")]),t._v(" 到你的 app target 里面；")]),t._v(" "),n("li",[t._v("在命令行输入 "),n("code",[t._v("pod install")]),t._v("；")]),t._v(" "),n("li",[t._v("用 Xcode 打开由 CocoaPods 自动生成的 "),n("code",[t._v(".xcworkspace")]),t._v(" 文件；")]),t._v(" "),n("li",[t._v("添加头文件 "),n("code",[t._v("#import <MMKV/MMKV.h>")]),t._v("，就可以愉快地开始你的 MMKV 之旅了。")])]),t._v(" "),n("p",[t._v("更多安装指引参考 "),n("a",{attrs:{href:"https://github.com/Tencent/MMKV/wiki/iOS_setup_cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS/macOS Setup"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"快速上手-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#快速上手-2"}},[t._v("#")]),t._v(" 快速上手")]),t._v(" "),n("p",[t._v("MMKV 的使用非常简单，无需任何配置，所有变更立马生效，无需调用 "),n("code",[t._v("synchronize")]),t._v("。在 App 启动时初始化 MMKV（设定 MMKV 的根目录），例如在"),n("code",[t._v("-[MyApp application: didFinishLaunchingWithOptions:]")]),t._v("里：")]),t._v(" "),n("div",{staticClass:"language-objective-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {\n    // init MMKV in the main thread\n    [MMKV initializeMMKV:nil];\n\n    //...\n    return YES;\n}\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("p",[t._v("MMKV 提供一个全局的实例，可以直接使用：")]),t._v(" "),n("div",{staticClass:"language-objective-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('MMKV *mmkv = [MMKV defaultMMKV];\n    \n[mmkv setBool:YES forKey:@"bool"];\nBOOL bValue = [mmkv getBoolForKey:@"bool"];\n    \n[mmkv setInt32:-1024 forKey:@"int32"];\nint32_t iValue = [mmkv getInt32ForKey:@"int32"];\n    \n[mmkv setString:@"hello, mmkv" forKey:@"string"];\nNSString *str = [mmkv getStringForKey:@"string"];\n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("p",[t._v("MMKV 支持"),n("strong",[t._v("多进程访问")]),t._v("，更详细的用法参考 "),n("a",{attrs:{href:"https://github.com/Tencent/MMKV/wiki/iOS_tutorial_cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS/macOS Tutorial"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"性能对比-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#性能对比-2"}},[t._v("#")]),t._v(" 性能对比")]),t._v(" "),n("p",[t._v("循环写入随机的"),n("code",[t._v("int")]),t._v(" 1w 次，我们有如下性能对比："),n("br"),t._v(" "),n("img",{attrs:{src:"https://github.com/Tencent/MMKV/wiki/assets/profile_mini.png",alt:""}}),n("br"),t._v("\n更详细的性能对比参考 "),n("a",{attrs:{href:"https://github.com/Tencent/MMKV/wiki/iOS_benchmark_cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS/macOS Benchmark"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"win32-指南"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#win32-指南"}},[t._v("#")]),t._v(" Win32 指南")]),t._v(" "),n("h3",{attrs:{id:"安装引入-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装引入-3"}},[t._v("#")]),t._v(" 安装引入")]),t._v(" "),n("p",[t._v("推荐使用子工程：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("获取 MMKV 源码：")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("git clone https://github.com/Tencent/MMKV.git\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])])]),t._v(" "),n("li",[n("p",[t._v("添加工程 "),n("code",[t._v("Win32/MMKV/MMKV.vcxproj")]),t._v(" 到你的项目里；")])]),t._v(" "),n("li",[n("p",[t._v("设置你的主工程依赖于 "),n("code",[t._v("MMKV")]),t._v(" 工程;")])]),t._v(" "),n("li",[n("p",[t._v("添加目录 "),n("code",[t._v("$(OutDir)include")]),t._v(" 到你主工程的 "),n("code",[t._v("C/C++")]),t._v(" -> "),n("code",[t._v("常规")]),t._v(" -> "),n("code",[t._v("附加包含目录")]),t._v(";")])]),t._v(" "),n("li",[n("p",[t._v("添加目录 "),n("code",[t._v("$(OutDir)")]),t._v(" 到你主工程的 "),n("code",[t._v("链接器")]),t._v(" -> "),n("code",[t._v("常规")]),t._v(" -> "),n("code",[t._v("附加库目录")]),t._v(";")])]),t._v(" "),n("li",[n("p",[t._v("添加 "),n("code",[t._v("MMKV.lib")]),t._v(" 到你主工程的 "),n("code",[t._v("链接器")]),t._v(" -> "),n("code",[t._v("输入")]),t._v(" -> "),n("code",[t._v("附加依赖项")]),t._v(";")])]),t._v(" "),n("li",[n("p",[t._v("添加头文件 "),n("code",[t._v("#include <MMKV/MMKV.h>")]),t._v("，就可以愉快地开始你的 MMKV 之旅了。")])])]),t._v(" "),n("p",[t._v("注意：")]),t._v(" "),n("ol",[n("li",[t._v("MMKV 默认使用 "),n("code",[t._v("MT/MTd")]),t._v(" 运行时库来编译，如果你发现主工程的配置不一样，请修改 MMKV 的配置再编译;")]),t._v(" "),n("li",[t._v("MMKV 使用 Visual Studio 2017 开发，如果你在使用其他版本的 Visual Studio，请修改 MMKV 的"),n("code",[t._v("工具集")]),t._v("与主工程一致，再编译.")])]),t._v(" "),n("p",[t._v("更多安装指引参考 "),n("a",{attrs:{href:"https://github.com/Tencent/MMKV/wiki/windows_setup_cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("Win32 Setup"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"快速上手-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#快速上手-3"}},[t._v("#")]),t._v(" 快速上手")]),t._v(" "),n("p",[t._v("MMKV 的使用非常简单，所有变更立马生效，无需调用 "),n("code",[t._v("save")]),t._v("、"),n("code",[t._v("sync")]),t._v("。\n在 App 启动时初始化 MMKV，设定 MMKV 的根目录，例如在 main() 里：")]),t._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("#include <MMKV/MMKV.h>\n\nint main() {\n    std::wstring rootDir = getYourAppDocumentDir();\n    MMKV::initializeMMKV(rootDir);\n    //...\n}\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("p",[t._v("MMKV 提供一个全局的实例，可以直接使用：")]),t._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('auto mmkv = MMKV::defaultMMKV();\n\nmmkv->set(true, "bool");\nstd::cout << "bool = " << mmkv->getBool("bool") << std::endl;\n\nmmkv->set(1024, "int32");\nstd::cout << "int32 = " << mmkv->getInt32("int32") << std::endl;\n\nmmkv->set("Hello, MMKV for Win32", "string");\nstd::string result;\nmmkv->getString("string", result);\nstd::cout << "string = " << result << std::endl;\n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])]),n("p",[t._v("MMKV 支持"),n("strong",[t._v("多进程访问")]),t._v("，更详细的用法参考 "),n("a",{attrs:{href:"https://github.com/Tencent/MMKV/wiki/windows_tutorial_cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("Win32 Tutorial"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"posix-指南"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#posix-指南"}},[t._v("#")]),t._v(" POSIX 指南")]),t._v(" "),n("h3",{attrs:{id:"安装引入-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装引入-4"}},[t._v("#")]),t._v(" 安装引入")]),t._v(" "),n("p",[t._v("推荐使用 CMake：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("获取 MMKV 源码：")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("git clone https://github.com/Tencent/MMKV.git\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])])]),t._v(" "),n("li",[n("p",[t._v("打开你项目的 "),n("code",[t._v("CMakeLists.txt")]),t._v(", 添加这几行:")]),t._v(" "),n("div",{staticClass:"language-cmake line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-cmake"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_subdirectory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mmkv/POSIX/src mmkv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("target_link_libraries")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MyApp\n    mmkv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])])]),t._v(" "),n("li",[n("p",[t._v("添加头文件 "),n("code",[t._v('#include "MMKV.h"')]),t._v("，就可以愉快地开始你的 MMKV 之旅了。")])])]),t._v(" "),n("p",[t._v("更多安装指引参考 "),n("a",{attrs:{href:"https://github.com/Tencent/MMKV/wiki/posix_setup_cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("POSIX Setup"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"快速上手-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#快速上手-4"}},[t._v("#")]),t._v(" 快速上手")]),t._v(" "),n("p",[t._v("MMKV 的使用非常简单，所有变更立马生效，无需调用 "),n("code",[t._v("save")]),t._v("、"),n("code",[t._v("sync")]),t._v("。\n在 App 启动时初始化 MMKV，设定 MMKV 的根目录，例如在 main() 里：")]),t._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('#include "MMKV.h"\n\nint main() {\n    std::string rootDir = getYourAppDocumentDir();\n    MMKV::initializeMMKV(rootDir);\n    //...\n}\n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("p",[t._v("MMKV 提供一个全局的实例，可以直接使用：")]),t._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('auto mmkv = MMKV::defaultMMKV();\n\nmmkv->set(true, "bool");\nstd::cout << "bool = " << mmkv->getBool("bool") << std::endl;\n\nmmkv->set(1024, "int32");\nstd::cout << "int32 = " << mmkv->getInt32("int32") << std::endl;\n\nmmkv->set("Hello, MMKV for Win32", "string");\nstd::string result;\nmmkv->getString("string", result);\nstd::cout << "string = " << result << std::endl;\n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])]),n("p",[t._v("MMKV 支持"),n("strong",[t._v("多进程访问")]),t._v("，更详细的用法参考 "),n("a",{attrs:{href:"https://github.com/Tencent/MMKV/wiki/posix_tutorial_cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("POSIX Tutorial"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"license"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#license"}},[t._v("#")]),t._v(" License")]),t._v(" "),n("p",[t._v("MMKV 以 BSD 3-Clause 证书开源，详情参见 "),n("a",{attrs:{href:"./LICENSE.TXT"}},[t._v("LICENSE.TXT")]),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"版本历史"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#版本历史"}},[t._v("#")]),t._v(" 版本历史")]),t._v(" "),n("p",[t._v("具体版本历史请参看 "),n("RouterLink",{attrs:{to:"/nav.third-party/nav.mmkv/CHANGELOG.html"}},[t._v("CHANGELOG.md")]),t._v("。")],1),t._v(" "),n("h2",{attrs:{id:"参与贡献"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参与贡献"}},[t._v("#")]),t._v(" 参与贡献")]),t._v(" "),n("p",[t._v("如果你有兴趣参与贡献，可以参考 "),n("RouterLink",{attrs:{to:"/nav.third-party/nav.mmkv/CONTRIBUTING.html"}},[t._v("CONTRIBUTING.md")]),t._v("。\n"),n("a",{attrs:{href:"https://opensource.tencent.com/contribution",target:"_blank",rel:"noopener noreferrer"}},[t._v("腾讯开源激励计划"),n("OutboundLink")],1),t._v(" 鼓励开发者的参与和贡献，期待你的加入。")],1),t._v(" "),n("p",[t._v("为了明确我们对参与者的期望，MMKV 采用了被广泛使用的、由 Contributor Covenant 所定义的行为准则。我们认为它很好地阐明了我们的价值观。有关更多信息请查看 "),n("RouterLink",{attrs:{to:"/nav.third-party/nav.mmkv/CODE_OF_CONDUCT.html"}},[t._v("Code of Conduct")]),t._v("。")],1),t._v(" "),n("h2",{attrs:{id:"问题-反馈"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题-反馈"}},[t._v("#")]),t._v(" 问题 & 反馈")]),t._v(" "),n("p",[t._v("常见问题参见 "),n("a",{attrs:{href:"https://github.com/Tencent/MMKV/wiki/FAQ_cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("FAQ"),n("OutboundLink")],1),t._v("，欢迎提 "),n("a",{attrs:{href:"https://github.com/Tencent/MMKV/issues",target:"_blank",rel:"noopener noreferrer"}},[t._v("issues"),n("OutboundLink")],1),t._v(" 提问反馈。")])])}),[],!1,null,null,null);s.default=e.exports}}]);