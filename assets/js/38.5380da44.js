(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{397:function(e,t,a){"use strict";a.r(t);var s=a(42),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"database-encryption"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#database-encryption"}},[e._v("#")]),e._v(" Database Encryption")]),e._v(" "),a("p",[e._v("greenDAO supports encrypted databases to protect sensitive data.")]),e._v(" "),a("p",[e._v("While newer versions of Android support file system encryption, Android itself does not provide encryption for database files. So if an attacker obtains access to a database file (by gaining root access, for example by exploiting a security flaw or tricking the user of a rooted device), the attacker may get access to all data inside that database. Using a password-protected, encrypted database adds an additional layer of security. It prevents an attacker from simply opening the database file.")]),e._v(" "),a("h2",{attrs:{id:"using-custom-sqlite-builds"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-custom-sqlite-builds"}},[e._v("#")]),e._v(" Using custom SQLite builds")]),e._v(" "),a("p",[e._v("Because Android does not support encrypted databases out of the box, you need to bundle a custom build of SQLite inside your APK. Those custom builds consist of CPU dependent, native code. So your APK size will grow by a couple of MByte. Thus, you should only use encryption if you really need it.")]),e._v(" "),a("h2",{attrs:{id:"setting-up-database-encryption"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-database-encryption"}},[e._v("#")]),e._v(" Setting up Database Encryption")]),e._v(" "),a("p",[e._v("greenDAO supports "),a("a",{attrs:{href:"https://www.zetetic.net/sqlcipher/",target:"_blank",rel:"noopener noreferrer"}},[e._v("SQLCipher"),a("OutboundLink")],1),e._v(" with a binding directly. SQLCipher is a custom build of SQLite using 256-bit AES encryption.")]),e._v(" "),a("h3",{attrs:{id:"add-the-sqlcipher-dependency"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add-the-sqlcipher-dependency"}},[e._v("#")]),e._v(" Add the SQLCipher dependency")]),e._v(" "),a("p",[e._v("See the "),a("a",{attrs:{href:"https://www.zetetic.net/sqlcipher/sqlcipher-for-android/",target:"_blank",rel:"noopener noreferrer"}},[e._v("SQLCipher for Android"),a("OutboundLink")],1),e._v(" page on how to add SQLCipher to your project.")]),e._v(" "),a("h3",{attrs:{id:"database-initialization"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#database-initialization"}},[e._v("#")]),e._v(" Database Initialization")]),e._v(" "),a("p",[e._v("Make sure to use a subclass of OpenHelper provided in DaoMaster to create your database instance. For example the simple DevOpenHelper, also provided in DaoMaster.")]),e._v(" "),a("p",[e._v("Then, when creating your database instance, just call .getEncryptedWritableDb("),a("password",[e._v(") instead of .getWritableDb(). Finally, pass the database to DaoMaster as usual:")])],1),e._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("DevOpenHelper")]),e._v(" helper "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("DevOpenHelper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"notes-db-encrypted.db"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Database")]),e._v(" db "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" helper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("getEncryptedWritableDb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<your-secret-password>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\ndaoSession "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("DaoMaster")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("newSession")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("h2",{attrs:{id:"database-abstraction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#database-abstraction"}},[e._v("#")]),e._v(" Database Abstraction")]),e._v(" "),a("p",[e._v("greenDAO uses a thin abstraction layer for all database interaction, so standard and non-standard SQLite implementations are supported:")]),e._v(" "),a("ul",[a("li",[e._v("Android’s standard android.database.sqlite.SQLiteDatabase")]),e._v(" "),a("li",[e._v("SQLCipher’s net.sqlcipher.database.SQLiteDatabase")]),e._v(" "),a("li",[e._v("Any SQLite compatible database, which can implement org.greenrobot.greendao.database.Database (for example custom builds of SQLite)")])]),e._v(" "),a("p",[e._v("This enables you to switch easily from standard to encrypted databases because your code will be the same when targeting DaoSession and individual DAOs.")]),e._v(" "),a("h3",{attrs:{id:"unit-testing-with-robolectric"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unit-testing-with-robolectric"}},[e._v("#")]),e._v(" Unit testing with Robolectric")]),e._v(" "),a("p",[e._v("Database abstraction allows unit testing with Robolectric. Even "),a("strong",[e._v("when your app uses an encrypted database, your tests can use an unencrypted database")]),e._v(".")]),e._v(" "),a("p",[e._v("Robolectric implements the standard SQLite API and has no way of loading custom SQLite builds (Android binaries). So for your tests, use .getWritableDb() instead of .getEncryptedWritableDb("),a("password",[e._v(") when creating your database instance (see above).")])],1),e._v(" "),a("h3",{attrs:{id:"known-issues-with-sqlcipher"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#known-issues-with-sqlcipher"}},[e._v("#")]),e._v(" Known issues with SQLCipher")]),e._v(" "),a("p",[e._v("SQLCipher is a custom build of SQLite. Its Android APIs have diverged a bit from the Android system APIs. Here are the issues we noticed (unrelated to greenDAO):")]),e._v(" "),a("ul",[a("li",[e._v("Exceptions thrown are not of type android.database.SQLException (see "),a("a",{attrs:{href:"https://github.com/sqlcipher/android-database-sqlcipher/issues/223",target:"_blank",rel:"noopener noreferrer"}},[e._v("SQLcipher issue 223"),a("OutboundLink")],1),e._v(")")]),e._v(" "),a("li",[e._v("SQLCipher locks much more than recent SQLiteDatabase implementations. This not just reduces concurrency, but also increases the chance to deadlock.")]),e._v(" "),a("li",[e._v("Android collations (like LOCALIZED) are absent starting with "),a("a",{attrs:{href:"http://greenrobot.org/android/database-encryption-for-android-n-sqlcipher-3-5/",target:"_blank",rel:"noopener noreferrer"}},[e._v("SQLCipher 3.5.0"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);